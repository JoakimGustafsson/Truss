<!doctype html>
<html>

<head>
	<meta charset="UTF-8" />
	<script src="Javascript/Primitives.js" type="text/javascript"></script>
	<script src="Javascript/FileSave.js" type="text/javascript"></script>
	<script src="Javascript/View.js" type="text/javascript"></script>
	<script src="Javascript/Node.js" type="text/javascript"></script>
	<script src="Javascript/Tensors.js" type="text/javascript"></script>
	<script src="Javascript/Truss.js" type="text/javascript"></script>
	<script src="Javascript/Actuators.js" type="text/javascript"></script>
	<script src="Javascript/Sensors.js" type="text/javascript"></script>
	<script src="Javascript/Property.js" type="text/javascript"></script>
	<script src="Javascript/Pictures.js" type="text/javascript"></script>
	<script src="Javascript/ExperimentalTrusses.js" type="text/javascript"></script>
	<!--	<script src="Javascript/cycle.js" type="text/javascript"></script>
	<script src="Javascript/jquery-3.1.1.js"></script>  -->

	<link rel="stylesheet" type="text/css" href="../Stylefiles/Truss.css">

	<!-- <link rel="icon" type="image/png" href="../Pictures/Atlas white logotype.png" />
<link rel="shortcut icon" href="../Pictures/Atlas white logotype.png" />  -->


	<title>Truss</title>

</head>

<body style="background-color: #343f48; margin:0px;">
	<img id="dimage" src="Resources/facade.jpg" style="position: absolute; left:0px; top:0px; width: 200px; height: 200px; "
	    alt="Mountain View">

	<section>

		<div class="" id="configarea" style="position: absolute; z-index:1000; color: pink; width:500px; height:300px;">

			<div class="tab">
				<button class="tablinks tabsectionheader" id="propertiesButton" onclick="openBottomPanel(event, 'propertiesDiv')">PROPERTIES</button>
				<!-- <button class="tablinks tabsectionheader" id="propertiesButton" onclick="openBottomPanel(event, 'connectionDiv');">CONNECTIONS</button>
				<button class="tablinks tabsectionheader" id="addButton" onclick="openBottomPanel(event, 'addDiv')">ADD</button>
				<!-- <button class="tablinks tabsectionheader" onclick="openBottomPanel(event, 'generalDiv'); ">GENERAL</button> -->
				<button class="tablinks tabsectionheader advanced" onclick="openBottomPanel(event, 'fileDiv'); directory('Saves');">FILE</button>
			</div>

			<div id="propertiesDiv" class="footerbackgroundarea tabcontent">
				<!--- div class="sectionheader">Configuration</div> -->
				<div class="sectionbase" id="configview"></div>

				<div id="connectionDiv" class="sectionbase">
				</div>


				<div id="addDiv" class="sectionbase">
						<!-- div class="sectionheader">Configuration</div> -->
						<div>
							<select id='nodeType' oninput=''>
								<option value='Node'>Node</option>
								<option value=''>--Sensors--</option>
								<option value='KeySensorNode'>KeySensor</option>
								<option value='ProximitySensornODE'>ProximitySensor</option>
								<option value=''>--Actuators--</option>
								<option value='jumpNode'>JumpNodeActuator</option>
								<option value='LeftRightNode'>LeftRightActuator</option>
								<option value='Linebreakernode'>LinebreakerActuator</option>
								</select>
							<button class="simpleButton" type="button" onclick="makeNode()">Create</button>
						</div>
						<div>
								<select id='tensorType' oninput=''>
										<option value='Spring'>Spring</option>
										<option value='PullSpring'>PullSpring</option>
									<option value='Absorber'>Absorber</option>
									<option value='Field'>Field</option>
									</select>
							<button class="simpleButton" type="button" onclick="makeTensor()">Create</button>
						</div>
					</div>
		
				<div>
					<button class="simpleButton" type="button" onclick="mainNode.togglePause()">Pause</button>
					<button class="simpleButton" type="button" onclick="mainNode.toggleMove()">Lock</button>
					<button class="simpleButton" type="button" onclick="addGravityCheat();">Gravity</button>
					<button class="simpleButton" type="button" onclick="">Delete</button>
				</div>
			</div>

			<div id="addDiv" class="footerbackgroundarea tabcontent">
				<!-- div class="sectionheader">Configuration</div> -->
				<div>
					<button class="simpleButton" type="button">New Node</button>
				</div>
				<div>
					<button class="simpleButton" type="button">New Tensor</button>
				</div>
			</div>

			<div id="generalDiv" class="footerbackgroundarea tabcontent">
				< general stuff>
			</div>


			<div id="fileDiv" class="footerbackgroundarea tabcontent">

				<div class="sectionbase" id="configview">

					<div class="fileList" id="fileList">X</div>

					<div class="valuepair">
						<div title="Filename" class="lname">Filename</div>
						<div class="rvalue">' +
							<input class="text" type="text" id="fileNameInput" value="myFile" style="text-align: right; width:140px;">
						</div>
					</div>
				</div>


				<button class="simpleButton" type="button" onclick="saveFile(document.getElementById('fileNameInput').value);">Save</button>

			</div>


		</div>


		<div id="FPSdisplay" style="position: absolute; left:10px; top:10px; color: white;">
		</div>
	

		<div id="TrussBackground" align="left">

		</div>


		<script type="text/javascript">
			var mainNode;
			var newMainNode;
			var savedState = 0;

			var tensors, nodes;
			var selectedObject

			//Main Draw loop
			function mainLoop(timestamp) {
				if (newMainNode) {
					mainNode.truss.clear();
					mainNode = newMainNode;

					mainNode.canvas.onmousemove = myMove;
					mainNode.canvas.onmousedown = downMouse;
					mainNode.canvas.onmouseup = upMouse;

					newMainNode = undefined;
				}
				mainNode.tick(timestamp / 1000);
				requestAnimationFrame(mainLoop);
			}

			// Setting up the canvas and ensure other initialization routines are run
			function init() {
				let WIDTH = 2000;
				let HEIGHT = 1000;
				FPSdisplay = document.getElementById("FPSdisplay");

				let mainView = new View(new Vector(WIDTH, HEIGHT), new Vector(18, 9));
				mainNode = new TrussNode(new Position(0, 0), mainView, 1 / 60, 1, "MainNode", WalkTruss);
				mainNode.truss.initiate();


				// selectedObject = mainNode;

				window.requestAnimationFrame(mainLoop);



				mainView.context.canvas.onmousemove = myMove;
				mainView.context.canvas.onmousedown = downMouse;
				mainView.context.canvas.onmouseup = upMouse;

				let configarea = document.getElementById('configarea');
				let connectionDiv = document.getElementById('connectionDiv');
				

				document.addEventListener('selectionEvent',
					function (e) {
						select.call(this, e);
					}, false);

				
				openBottomPanel(event, 'propertiesDiv');
				configarea.style.display = "none";

			}


			// Make sure the init is not run until all is set up. Hmmm, stop using JQuery
			//$().ready(init);


			let myX = 3;
			let myY = 3;
			let mouseSet = false;
			/**
			 * @param  {Event} e
			 */
			function myMove(e) {
				myX = e.pageX;
				myY = e.pageY;
			}

			/**
			 * @param  {Event} e
			 */
			function downMouse(e) {
				mouseSet = true;
			}

			/**
			 * @param  {Event} e
			 */
			function upMouse(e) {
				mouseSet = false;
			}



			function openBottomPanel(evt, divName) {
				// Declare all variables
				var i, tabcontent, tablinks;

				// Get all elements with class="tabcontent" and hide them
				tabcontent = document.getElementsByClassName("tabcontent");
				for (i = 0; i < tabcontent.length; i++) {
					tabcontent[i].style.display = "none";
				}

				// Get all elements with class="tablinks" and remove the class "active"
				tablinks = document.getElementsByClassName("tablinks");
				for (i = 0; i < tablinks.length; i++) {
					tablinks[i].className = tablinks[i].className.replace(
						" active", "");
				}

				// Show the current tab, and add an "active" class to the button that opened the tab
				document.getElementById(divName).style.display = "block";

				if (evt)
					evt.currentTarget.className += " active";
				else
					document.getElementById("propertiesButton").className += " active";
			}


			/**
			 * @param  {Event} selectionEvent
			 */
			function select(selectionEvent) {
				let select = selectionEvent.detail.selectedObject;
				if (!select) {
					connectionDiv.innerHTML = '';
					return;
				}
				let previousSelectedObject = selectionEvent.detail.previousSelectedObject;
				select.setHighlight(2);
				if (previousSelectedObject) {
					previousSelectedObject.setHighlight(0);
				}
				connectionDiv.innerHTML = '';
				connectionDiv.appendChild(select.generateconnectionHTML());
			}

			function makeNode() {
				let selector = document.getElementById('nodeType');
				let value = selector.value;
				if (value == 'Node') {
					mainNode.truss.addNode(new Node(new Position(1, 1), 10, 'node'));
				}
			}

			var connectionTensor;

			function makeTensor() {
				let selector = document.getElementById('tensorType');
				let value = selector.value;
				if (value == 'Spring') {
					connectionTensor=mainNode.truss.addTensor(new Spring(selectedObject, sensor, 100));
					
				document.addEventListener('selectionEvent',
					function (e) {
						if (connectionTensor) {
							attach(connectionTensor);
							connectionTensor=undefined;
						}
						
					}, false);
				}
			}

			function attach(tensor) {
				if (tensor.node1==sensor) {
					tensor.addNode1(selectedObject);
				} else if (tensor.node2==sensor) {
					tensor.addNode2(selectedObject);
				} 
			}

			function addGravityCheat() {
				mainNode.truss.addTensor(gravityField(selectedObject));
			}

			init();
		</script>

	</section>
</body>

</html>